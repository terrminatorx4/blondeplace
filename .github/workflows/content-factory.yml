name: 🚨 Emergency Content Factory

on:
  workflow_dispatch:
    inputs:
      topic_count:
        description: 'Количество статей'
        required: true
        default: '1'
        type: choice
        options: ['1', '5', '10', '20']

jobs:
  emergency-factory:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        thread: ${{ fromJson(format('[{0}]', join(range(1, fromJson(github.event.inputs.topic_count) + 1), ', '))) }}
      max-parallel: 20
      fail-fast: false

    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: '20'
      
      - name: Install minimal deps
        run: npm install @octokit/rest --no-save

      - name: 🚨 Generate Emergency Content
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          cat > gen.js << 'EOF'
          import { Octokit } from '@octokit/rest';
          const octokit = new Octokit({ auth: process.env.GITHUB_TOKEN });
          const thread = '${{ matrix.thread }}';
          const slug = 'emergency-' + thread + '-' + Date.now();
          const content = `---
title: "Экстренная красота в BLONDE PLACE (поток ${thread})"
description: "Срочная помощь красоте от экспертов BLONDE PLACE"
pubDate: "${new Date().toISOString()}"
author: "BLONDE PLACE Emergency Team"
heroImage: "https://images.unsplash.com/photo-1604654894610-df63bc536371?q=80&w=2070&auto=format&fit=crop&t=${Date.now()}"
category: "beauty-tips"
tags: ["экстренная помощь", "BLONDE PLACE"]
keywords: "экстренная помощь красоте, BLONDE PLACE, beauty SOS"
---

# Экстренная помощь красоте

В BLONDE PLACE мы всегда готовы помочь в критических beauty-ситуациях!

## 🚨 Наши экстренные услуги:
- Срочная коррекция окрашивания
- Экспресс-восстановление волос  
- SOS-уход за кожей
- Быстрый маникюр

📞 +7 (981) 960-87-22
💬 @Blondeplace
🌐 dikidi.ru/699327
`;
          await octokit.rest.repos.createOrUpdateFileContents({
            owner: 'terrminatorx4',
            repo: 'blondeplace', 
            path: `src/content/posts/${slug}.md`,
            message: `🚨 Emergency content ${slug}`,
            content: Buffer.from(content).toString('base64')
          });
          console.log('✅ Emergency content created:', slug);
          EOF
          node gen.js