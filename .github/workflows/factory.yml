name: 🚨 Emergency Content Factory

on:
  workflow_dispatch:
    inputs:
      topic_count:
        description: 'Количество статей'
        required: true
        default: '1'
        type: choice
        options: ['1', '5', '10', '20']

jobs:
  emergency:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        thread: ${{ fromJson(format('[{0}]', join(range(1, fromJson(github.event.inputs.topic_count) + 1), ', '))) }}
      max-parallel: 20
      fail-fast: false

    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: '20'
      
      - run: npm install @octokit/rest --no-save

      - name: Generate Emergency Content
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          cat > gen.mjs << 'EOF'
          import { Octokit } from '@octokit/rest';
          const octokit = new Octokit({ auth: process.env.GITHUB_TOKEN });
          const thread = '${{ matrix.thread }}';
          const timestamp = Date.now();
          const slug = 'emergency-beauty-' + thread + '-' + timestamp;
          const content = `---
title: "Экстренная красота BLONDE PLACE (поток ${thread})"
description: "Срочная помощь красоте от экспертов BLONDE PLACE"
pubDate: "${new Date().toISOString()}"
author: "BLONDE PLACE Emergency Team"
heroImage: "https://images.unsplash.com/photo-1604654894610-df63bc536371?q=80&w=2070&auto=format&fit=crop&t=${timestamp}"
category: "beauty-tips"
tags: ["экстренная помощь", "BLONDE PLACE"]
keywords: "экстренная помощь красоте, BLONDE PLACE, beauty SOS"
---

# Экстренная помощь красоте в BLONDE PLACE

🚨 Thread ${thread}: Когда красота требует немедленного вмешательства!

## Наши экстренные услуги:
- Срочная коррекция окрашивания
- Экспресс-восстановление волос  
- SOS-уход за кожей
- Быстрый маникюр

## Контакты для экстренной записи:
📞 **Телефон**: +7 (981) 960-87-22
💬 **Телеграм**: @Blondeplace  
🌐 **Онлайн**: dikidi.ru/699327

*Emergency content created by thread ${thread} at ${new Date().toLocaleString('ru-RU')}*
`;
          await octokit.rest.repos.createOrUpdateFileContents({
            owner: 'terrminatorx4', 
            repo: 'blondeplace', 
            path: `src/content/posts/${slug}.md`,
            message: `🚨 Emergency beauty content from thread ${thread}`,
            content: Buffer.from(content).toString('base64')
          });
          console.log('✅ Emergency content created:', slug);
          EOF
          node gen.mjs

      - name: Success Report
        run: |
          echo "✅ Thread ${{ matrix.thread }} completed successfully"
          echo "🚨 Emergency content generated"