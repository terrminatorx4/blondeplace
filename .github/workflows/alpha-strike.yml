name: üöÄ Alpha-Strike v5.27 - FORCE CACHE CLEAN
on:
  workflow_dispatch:
    inputs:
      model:
        description: '–ú–æ–¥–µ–ª—å –ò–ò (gemini/openrouter)'
        required: true
        default: 'gemini'
        type: choice
        options:
          - gemini
          - openrouter
      threads:
        description: '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ—Ç–æ–∫–æ–≤ (1-20)'
        required: true
        default: '5'
        type: string
      articles_per_thread:
        description: '–°—Ç–∞—Ç–µ–π –Ω–∞ –ø–æ—Ç–æ–∫ (1-10)'
        required: true
        default: '5'
        type: string

jobs:
  alpha-strike:
    runs-on: ubuntu-latest
    timeout-minutes: 60
    
    steps:
    - name: üîÑ Force Cache Clean Checkout
      uses: actions/checkout@v4
      with:
        fetch-depth: 0
        clean: true
        
    - name: üßπ Clear All Caches  
      run: |
        echo "üö® –ü–†–ò–ù–£–î–ò–¢–ï–õ–¨–ù–ê–Ø –û–ß–ò–°–¢–ö–ê –í–°–ï–• –ö–≠–®–ï–ô!"
        rm -rf node_modules/.cache || true
        rm -rf .next/cache || true
        rm -rf .astro/cache || true
        echo "‚úÖ –ö—ç—à–∏ –æ—á–∏—â–µ–Ω—ã"
        
    - name: ‚ö° Setup Node.js 18
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        cache: 'npm'
        
    - name: üì¶ Install Dependencies
      run: |
        echo "üîÑ –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏..."
        npm ci --no-cache
        
    - name: üîç Verify Alpha-Factory Version
      run: |
        echo "üîç –ü–†–û–í–ï–†–Ø–Æ –í–ï–†–°–ò–Æ ALPHA-FACTORY:"
        head -3 alpha-factory-v5.10-BUTLER-RETRY.js
        echo ""
        echo "üîç –ü–†–û–í–ï–†–Ø–Æ baseNumber = 200000:"
        grep -n "baseNumber.*200000" alpha-factory-v5.10-BUTLER-RETRY.js || echo "‚ùå –ù–ï –ù–ê–ô–î–ï–ù!"
        
    - name: üöÄ Alpha-Strike FORCE v5.27
      env:
        GEMINI_API_KEYS_POOL: ${{ secrets.GEMINI_API_KEYS_POOL }}
        OPENROUTER_API_KEYS_POOL: ${{ secrets.OPENROUTER_API_KEYS_POOL }}
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      run: |
        echo "üöÄ –ó–ê–ü–£–°–ö ALPHA-STRIKE v5.27 —Å baseNumber = 200000!"
        echo "ü§ñ –ú–æ–¥–µ–ª—å: ${{ github.event.inputs.model }}"
        echo "üìä –ü–æ—Ç–æ–∫–æ–≤: ${{ github.event.inputs.threads }}"
        echo "üìä –°—Ç–∞—Ç–µ–π –Ω–∞ –ø–æ—Ç–æ–∫: ${{ github.event.inputs.articles_per_thread }}"
        echo "üéØ –û–∂–∏–¥–∞–µ–º—ã–µ –Ω–æ–º–µ—Ä–∞: 200000-202000"
        echo ""
        node alpha-factory-v5.10-BUTLER-RETRY.js \
          --model ${{ github.event.inputs.model }} \
          --threads ${{ github.event.inputs.threads }} \
          --articles ${{ github.event.inputs.articles_per_thread }}
          
    - name: üìä Build Status
      run: |
        echo "‚úÖ Alpha-Strike v5.27 –∑–∞–≤–µ—Ä—à–µ–Ω!"
        echo "üéØ –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–æ–º–µ—Ä–∞ –Ω–æ–≤—ã—Ö —Ñ–∞–π–ª–æ–≤: –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å 200000+" 