name: üöÄüí• –ü–õ–ê–ù "–ê–õ–¨–§–ê-–£–î–ê–†" v4.0 - –ò–ù–§–û–†–ú–ê–¶–ò–û–ù–ù–´–ô –¶–ï–ù–¢–†

on:
  workflow_dispatch:
    inputs:
      target_articles:
        description: '–û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç–∞—Ç–µ–π –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏'
        required: true
        default: '600'
        type: choice
        options:
          - '600'
          - '1000'
          - '2000'
          - '5000'
      threads:
        description: '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –ø–æ—Ç–æ–∫–æ–≤ (1-20)'
        required: true
        default: '20'
        type: choice
        options:
          - '5'
          - '10'
          - '20'
      model_choice:
        description: '–í—ã–±–æ—Ä AI –º–æ–¥–µ–ª–∏'
        required: true
        default: 'gemini'
        type: choice
        options:
          - 'gemini'
          - 'deepseek'
      start_from_thread:
        description: '–ù–∞—á–∞—Ç—å —Å –ø–æ—Ç–æ–∫–∞ (–¥–ª—è —á–∞—Å—Ç–∏—á–Ω—ã—Ö –∑–∞–ø—É—Å–∫–æ–≤)'
        required: false
        default: '1'

jobs:
  alpha-strike-preparation:
    name: üéØ –ü–û–î–ì–û–¢–û–í–ö–ê –ö –û–ü–ï–†–ê–¶–ò–ò "–ê–õ–¨–§–ê-–£–î–ê–†"
    runs-on: ubuntu-latest
    outputs:
      articles-per-thread: ${{ steps.calculate.outputs.articles-per-thread }}
      expected-links: ${{ steps.calculate.outputs.expected-links }}
      thread-matrix: ${{ steps.calculate.outputs.thread-matrix }}
      
    steps:
    - name: üìä –†–ê–°–ß–ï–¢ –ü–ê–†–ê–ú–ï–¢–†–û–í –û–ü–ï–†–ê–¶–ò–ò
      id: calculate
      run: |
        TARGET_ARTICLES=${{ github.event.inputs.target_articles || '600' }}
        THREADS=${{ github.event.inputs.threads || '20' }}
        START_FROM=${{ github.event.inputs.start_from_thread || '1' }}
        
        # –†–∞—Å—á–µ—Ç —Å—Ç–∞—Ç–µ–π –Ω–∞ –ø–æ—Ç–æ–∫
        ARTICLES_PER_THREAD=$(( TARGET_ARTICLES / THREADS ))
        if [ $(( TARGET_ARTICLES % THREADS )) -ne 0 ]; then
          ARTICLES_PER_THREAD=$(( ARTICLES_PER_THREAD + 1 ))
        fi
        
        # –°–æ–∑–¥–∞–µ–º –º–∞—Ç—Ä–∏—Ü—É –ø–æ—Ç–æ–∫–æ–≤ –Ω–∞—á–∏–Ω–∞—è —Å —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ
        THREAD_LIST=""
        for i in $(seq $START_FROM $THREADS); do
          if [ -z "$THREAD_LIST" ]; then
            THREAD_LIST="$i"
          else
            THREAD_LIST="$THREAD_LIST,$i"
          fi
        done
        
        # –û–∂–∏–¥–∞–µ–º–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Å—ã–ª–æ–∫ (85 —Å—Å—ã–ª–æ–∫ –Ω–∞ —Å—Ç–∞—Ç—å—é)
        EXPECTED_LINKS=$(( TARGET_ARTICLES * 85 ))
        
        echo "articles-per-thread=$ARTICLES_PER_THREAD" >> $GITHUB_OUTPUT
        echo "expected-links=$EXPECTED_LINKS" >> $GITHUB_OUTPUT
        echo "thread-matrix=[$THREAD_LIST]" >> $GITHUB_OUTPUT
        
        echo "üéØ –ü–õ–ê–ù –û–ü–ï–†–ê–¶–ò–ò:"
        echo "   üì∞ –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç–∞—Ç–µ–π: $TARGET_ARTICLES"
        echo "   üîó –û–∂–∏–¥–∞–µ–º–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Å—ã–ª–æ–∫: $EXPECTED_LINKS"
        echo "   ‚ö° –ü–æ—Ç–æ–∫–æ–≤: $THREADS (–Ω–∞—á–∏–Ω–∞—è —Å $START_FROM)"
        echo "   üìä –°—Ç–∞—Ç–µ–π –Ω–∞ –ø–æ—Ç–æ–∫: $ARTICLES_PER_THREAD"
        echo "   üéÆ –ú–æ–¥–µ–ª—å AI: ${{ github.event.inputs.model_choice || 'gemini' }}"

  alpha-strike-attack:
    name: üöÄüí• –ê–õ–¨–§–ê-–£–î–ê–† #${{ matrix.thread-id }}
    runs-on: ubuntu-latest
    needs: alpha-strike-preparation
    strategy:
      max-parallel: 20
      matrix:
        thread-id: ${{ fromJson(needs.alpha-strike-preparation.outputs.thread-matrix) }}
    
    steps:
    - name: üì• –ü–û–õ–£–ß–ï–ù–ò–ï –ö–û–î–ê –û–ü–ï–†–ê–¶–ò–ò
      uses: actions/checkout@v4
      
    - name: ‚öôÔ∏è –£–°–¢–ê–ù–û–í–ö–ê Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '20'
        
    - name: üì¶ –£–°–¢–ê–ù–û–í–ö–ê –ó–ê–í–ò–°–ò–ú–û–°–¢–ï–ô
      run: |
        npm install @google/generative-ai
        npm install node-fetch
        npm install execa
        
    - name: üöÄüí• –ó–ê–ü–£–°–ö –ê–õ–¨–§–ê-–£–î–ê–†–ê v4.0 #${{ matrix.thread-id }}
      env:
        THREAD_ID: ${{ matrix.thread-id }}
        ALPHA_ARTICLES: ${{ needs.alpha-strike-preparation.outputs.articles-per-thread }}
        MODEL_CHOICE: ${{ github.event.inputs.model_choice || 'gemini' }}
        API_KEY_CURRENT: ${{ secrets.GEMINI_API_KEY }}
        OPENROUTER_API_KEY: ${{ secrets.OPENROUTER_API_KEY }}
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        GITHUB_REPOSITORY: ${{ github.repository }}
      run: |
        echo "üöÄüí• [–ê–õ–¨–§–ê-–£–î–ê–† #${{ matrix.thread-id }}] === –ù–ê–ß–ê–õ–û –ê–¢–ê–ö–ò v4.0 ==="
        echo "üìä –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ—Ç–æ–∫–∞:"
        echo "   üÜî ID –ø–æ—Ç–æ–∫–∞: ${{ matrix.thread-id }}"
        echo "   üì∞ –°—Ç–∞—Ç–µ–π –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏: ${{ needs.alpha-strike-preparation.outputs.articles-per-thread }}"
        echo "   ü§ñ –ú–æ–¥–µ–ª—å AI: ${{ github.event.inputs.model_choice || 'gemini' }}"
        echo "   üîë API –∫–ª—é—á: ...${API_KEY_CURRENT: -4}"
        
        # –ó–∞–ø—É—Å–∫ —Å—É–ø–µ—Ä-—É–ª—É—á—à–µ–Ω–Ω–æ–π —Ñ–∞–±—Ä–∏–∫–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
        node alpha-factory.js
        
        echo "‚úÖ [–ê–õ–¨–§–ê-–£–î–ê–† #${{ matrix.thread-id }}] === –ü–û–¢–û–ö –ó–ê–í–ï–†–®–ï–ù ==="

  alpha-strike-quality-control:
    name: üîç –ö–û–ù–¢–†–û–õ–¨ –ö–ê–ß–ï–°–¢–í–ê
    runs-on: ubuntu-latest
    needs: [alpha-strike-preparation, alpha-strike-attack]
    if: always()
    
    steps:
    - name: üì• –ü–û–õ–£–ß–ï–ù–ò–ï –ö–û–î–ê
      uses: actions/checkout@v4
      
    - name: üìä –ê–ù–ê–õ–ò–ó –°–û–ó–î–ê–ù–ù–û–ì–û –ö–û–ù–¢–ï–ù–¢–ê
      run: |
        echo "üîç === –ö–û–ù–¢–†–û–õ–¨ –ö–ê–ß–ï–°–¢–í–ê –û–ü–ï–†–ê–¶–ò–ò ==="
        
        # –ü–æ–¥—Å—á–µ—Ç —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
        if [ -d "src/content/posts" ]; then
          POST_COUNT=$(find src/content/posts -name "post*.md" | wc -l)
          echo "üì∞ –ù–∞–π–¥–µ–Ω–æ —Å—Ç–∞—Ç–µ–π: $POST_COUNT"
          
          # –ü—Ä–æ–≤–µ—Ä–∫–∞ —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤
          UNIQUE_TITLES=$(find src/content/posts -name "post*.md" -exec grep -h "^title:" {} \; | sort | uniq | wc -l)
          TOTAL_TITLES=$(find src/content/posts -name "post*.md" -exec grep -h "^title:" {} \; | wc -l)
          echo "üìã –£–Ω–∏–∫–∞–ª—å–Ω—ã–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏: $UNIQUE_TITLES –∏–∑ $TOTAL_TITLES"
          
          # –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–ª–∏–Ω—ã –º–µ—Ç–∞-—Ç–µ–≥–æ–≤ (–ø–µ—Ä–≤—ã–µ 5 —Ñ–∞–π–ª–æ–≤)
          echo "üìè –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–ª–∏–Ω—ã –º–µ—Ç–∞-—Ç–µ–≥–æ–≤ (–æ–±—Ä–∞–∑—Ü—ã):"
          find src/content/posts -name "post*.md" | head -5 | while read file; do
            TITLE=$(grep "^title:" "$file" | sed 's/title: "//g' | sed 's/"$//g')
            DESC=$(grep "^description:" "$file" | sed 's/description: "//g' | sed 's/"$//g')
            echo "   üìÑ $(basename "$file"): Title ${#TITLE} —Å–∏–º–≤–æ–ª–æ–≤, Description ${#DESC} —Å–∏–º–≤–æ–ª–æ–≤"
          done
          
          # –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Å—Å—ã–ª–æ–∫ (–ø–µ—Ä–≤—ã–µ 3 —Ñ–∞–π–ª–∞)
          echo "üîó –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Å—ã–ª–æ–∫ (–æ–±—Ä–∞–∑—Ü—ã):"
          find src/content/posts -name "post*.md" | head -3 | while read file; do
            LINKS=$(grep -o '<a href=' "$file" | wc -l)
            echo "   üìÑ $(basename "$file"): $LINKS —Å—Å—ã–ª–æ–∫"
          done
        else
          echo "‚ö†Ô∏è –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è src/content/posts –Ω–µ –Ω–∞–π–¥–µ–Ω–∞"
        fi
        
        echo "‚úÖ –ö–æ–Ω—Ç—Ä–æ–ª—å –∫–∞—á–µ—Å—Ç–≤–∞ –∑–∞–≤–µ—Ä—à–µ–Ω"

  alpha-strike-final-report:
    name: üìã –§–ò–ù–ê–õ–¨–ù–´–ô –û–¢–ß–ï–¢
    runs-on: ubuntu-latest
    needs: [alpha-strike-preparation, alpha-strike-attack, alpha-strike-quality-control]
    if: always()
    
    steps:
    - name: üì• –ü–û–õ–£–ß–ï–ù–ò–ï –ö–û–î–ê
      uses: actions/checkout@v4
      
    - name: üìã –°–û–ó–î–ê–ù–ò–ï –û–¢–ß–ï–¢–ê –û–ü–ï–†–ê–¶–ò–ò
      run: |
        cat > ALPHA_STRIKE_REPORT.md << 'EOF'
# üöÄüí• –û–¢–ß–ï–¢ –ü–û –û–ü–ï–†–ê–¶–ò–ò "–ê–õ–¨–§–ê-–£–î–ê–†" v4.0

## üìä –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –æ–ø–µ—Ä–∞—Ü–∏–∏
- **–°—Ç–∞—Ç–µ–π —Å–æ–∑–¥–∞–Ω–æ**: ${{ github.event.inputs.target_articles || '600' }}
- **–ü–æ—Ç–æ–∫–æ–≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ**: ${{ github.event.inputs.threads || '20' }}
- **–ú–æ–¥–µ–ª—å AI**: ${{ github.event.inputs.model_choice || 'gemini' }}
- **–û–∂–∏–¥–∞–µ–º–æ —Å—Å—ã–ª–æ–∫**: ${{ needs.alpha-strike-preparation.outputs.expected-links }}
- **–î–∞—Ç–∞ –æ–ø–µ—Ä–∞—Ü–∏–∏**: $(date)

## üéØ –°—Ç–∞—Ç—É—Å –æ–ø–µ—Ä–∞—Ü–∏–∏
- **–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞**: ${{ needs.alpha-strike-preparation.result }}
- **–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ**: ${{ needs.alpha-strike-attack.result }}
- **–ö–æ–Ω—Ç—Ä–æ–ª—å –∫–∞—á–µ—Å—Ç–≤–∞**: ${{ needs.alpha-strike-quality-control.result }}

## üìà –û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
- **–ù–∞—á–∞–ª–æ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏**: 24-48 —á–∞—Å–æ–≤
- **–†–æ—Å—Ç –ø–æ–∑–∏—Ü–∏–π**: 3-7 –¥–Ω–µ–π
- **–¢–û–ü-10 –ø–æ –∫–ª—é—á–∞–º**: 1-2 –Ω–µ–¥–µ–ª–∏
- **–¢–û–ü-1 –ø–æ –∫–ª—é—á–∞–º**: 2-4 –Ω–µ–¥–µ–ª–∏

## üîó –°—Å—ã–ª–æ—á–Ω–∞—è –∞–≥—Ä–µ—Å—Å–∏—è
- **–°—Å—ã–ª–æ–∫ –Ω–∞ —Å—Ç–∞—Ç—å—é**: 85
- **–û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ**: ${{ needs.alpha-strike-preparation.outputs.expected-links }}
- **–¶–µ–ª–µ–≤—ã–µ URL**: 10 —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ä–∞–∑–¥–µ–ª–æ–≤ blondeplace.ru

## üì± –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
1. –û—Ç—Å–ª–µ–∂–∏–≤–∞–π—Ç–µ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—é –≤ –Ø–Ω–¥–µ–∫—Å.–í–µ–±–º–∞—Å—Ç–µ—Ä
2. –ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ –ø–æ–∑–∏—Ü–∏–∏ –ø–æ –∫–ª—é—á–µ–≤—ã–º —Ñ—Ä–∞–∑–∞–º
3. –ê–Ω–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ —Ç—Ä–∞—Ñ–∏–∫ –Ω–∞ –æ—Å–Ω–æ–≤–Ω–æ–π —Å–∞–π—Ç
4. –ö–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–π—Ç–µ —Å—Å—ã–ª–æ—á–Ω—É—é –º–∞—Å—Å—É

## üöÄ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏
- –î–æ–∂–¥–∏—Ç–µ—Å—å –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏ (24-48 —á–∞—Å–æ–≤)
- –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ—Ç–æ–∫–∏
- –†–∞—Å—Å–º–æ—Ç—Ä–∏—Ç–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–æ 10,000 —Å—Ç–∞—Ç–µ–π

---
*–û—Ç—á–µ—Ç —Å–æ–∑–¥–∞–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∏—Å—Ç–µ–º–æ–π "–ê–ª—å—Ñ–∞-–£–¥–∞—Ä" v4.0*
EOF
        
        echo "üìã –û—Ç—á–µ—Ç —Å–æ–∑–¥–∞–Ω: ALPHA_STRIKE_REPORT.md"
        cat ALPHA_STRIKE_REPORT.md
        
    - name: üíæ –°–û–•–†–ê–ù–ï–ù–ò–ï –û–¢–ß–ï–¢–ê
      run: |
        git config --local user.email "action@github.com"
        git config --local user.name "GitHub Action"
        git add ALPHA_STRIKE_REPORT.md
        git commit -m "üìã –û—Ç—á–µ—Ç –æ–ø–µ—Ä–∞—Ü–∏–∏ –ê–ª—å—Ñ–∞-–£–¥–∞—Ä v4.0 - $(date)" || exit 0
        git push || exit 0 