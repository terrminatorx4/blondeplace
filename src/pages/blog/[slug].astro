---
// СЫ Т - читаем файлы напрямую
import fs from "fs";
import path from "path";

export const prerender = false;

export async function GET({ params }) {
  const { slug } = params;
  
  try {
    const filePath = path.join(process.cwd(), "src/content/posts", `${slug}.md`);
    
    if (!fs.existsSync(filePath)) {
      return new Response("404", { status: 404 });
    }
    
    const content = fs.readFileSync(filePath, "utf-8");
    const match = content.match(/^---\s*\n([\s\S]*?)\n---\s*\n([\s\S]*)$/);
    
    if (!match) return new Response("Error", { status: 400 });
    
    let title = "Статья";
    match[1].split("\n").forEach(line => {
      if (line.startsWith("title:")) {
        title = line.replace("title:", "").replace(/"/g, "").trim();
      }
    });
    
    return new Response(`<!DOCTYPE html><html><head><title>${title}</title></head><body><h1>${title}</h1><p>Статья загружена через сервер!</p></body></html>`, {
      headers: { "Content-Type": "text/html" }
    });
    
  } catch (error) {
    return new Response("Server Error", { status: 500 });
  }
}
---